<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Index</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <script src="lib/crypto.js"></script>
    <script src="lib/aes.js"></script>
    <script src="lib/mode-ecb.js"></script>
    <script src="lib/pad-nopadding.js"></script>
    <script src="lib/scrypt.js"></script>
    <script src="lib/neo-ts.js"></script>
  </head>
  <body>
    <div class="container">
      <fieldset>
        <h2>NEO Account To Ethereum Account Mapping</h2>
        <div class="home">
          <a class="home" href="/">Home</a>
        </div>
        <form id="bindForm">
          <textarea id="privateKeyWif" rows="5" class="ghost-input" placeholder="NEO Account Private Key WIF " required ></textarea>
          <input id="ethAddress" name="ethAddress" type="text" class="ghost-input" placeholder="Ethereum Address " value="<%=locals.ethAddress%>" required />
          <input type="button" class="ghost-button" value="Sign" onclick="sign();">
          <input type="button" class="ghost-button" value="Submit" onclick="submit();">
        </form>
      </fieldset>

      <% if(msg) { %>
        <p class="msg"> <%- msg %> </p>
      <% } %>
    </div>
  </body>

  <script>
   function sign() {
     const wif = document.getElementById("privateKeyWif").value.trim();
     const source = document.getElementById("ethAddress").value.trim();
     console.log(wif, source);
     const privKey = ThinNeo.Helper.GetPrivateKeyFromWIF(wif);
     const pubKey = ThinNeo.Helper.GetPublicKeyFromPrivateKey(privKey);
     const address = ThinNeo.Helper.GetAddressFromPublicKey(pubKey);
     console.log(privKey.toHexString(), pubKey.toHexString(), address);

     const sign = ThinNeo.Helper.Sign(source.hexToBytes(), privKey);
     const signHex = sign.toHexString();
     console.log("signHex", signHex);

     const form = document.getElementById("bindForm");
     form.action = "/bind?pubKey=" + pubKey.toHexString() +
                   "&neoAddress=" + address +
                   "&signText=" + signHex ;
     form.method = "post";

     // erease private key WIF in this page:
     document.getElementById("privateKeyWif").value = "";

     form.submit();
   }

   function submit() {

   }
  </script>
</html>
